\begin{problem}[System of ODEs] \label{prb:SystemODEs}

Consider the following initial value problem for a second-order  system of 
ordinary differential equations:
\begin{gather}
  \label{eq:SystemODEs_ode}
\begin{aligned}
2\ddot u_1-\ddot u_2  &= u_1(u_2+u_1)\;,\\
-\ddot u_{i-1} + 2\ddot u_i-\ddot u_{i+1}  &= u_i(u_{i-1}+u_{i+1})\;,
\qquad i=2,\ldots,n-1\;,\\
2\ddot u_n-\ddot u_{n-1}  &= u_n(u_n+u_{n-1})\;,\\
u_i(0) &= u_{0,i} \qquad i=1,\ldots,n\;,\\
\dot u_i(0) &= v_{0,i} \qquad i=1,\ldots,n\;,
\end{aligned}
\end{gather}
in the time interval $[0,T]$.

% \subproblem\pts{3}
% Rewrite the initial value problem \eqref{eq:ode} as an initial value problem for a
% first-order ODE \Blue{$\dot{\Vy} = \Vf(\Vy)$}. 

%%%%%%%%%%%% SUBPROBLEM 1

\begin{subproblem}[3] \label{subprb:SystemODEs_1}
Write \eqref{eq:SystemODEs_ode} as a first order IVP of the form $\dot \Vy = \Vf(\Vy)$, $\Vy(0)=\Vy_0$ (see \lref{rem:hightoone}).


\begin{solution}
The second order IVP can be rewritten as a first order one by introducing $\Vv$:
\begin{align*}
\dot u_i & = v_i  \qquad i=1,\ldots,n\;,\\
2\dot v_1-\dot v_2  &= u_1(u_2+u_1)\;,\\
-\dot v_{i-1} + 2\dot v_i-\dot v_{i+1}  &= u_i(u_{i-1}+u_{i+1})\qquad i=2,\ldots,n-1\;,\\
2\dot v_n-\dot v_{n-1}  &= u_n(u_n+u_{n-1})\;,\\
u_i(0) &= u_{0,i} \qquad i=1,\ldots,n\;,\\
v_i(0) &= v_{0,i} \qquad i=1,\ldots,n\;.
\end{align*}
The ODE system can be written in vector form
$$\dot\Vu=\Vv\;,\qquad  \VC\dot\Vv = \Vg(\Vu):=
\begin{bmatrix}    u_1(u_2+u_1)\\  u_i(u_{i-1}+u_{i+1})\\   u_n(u_n+u_{n-1})  \end{bmatrix}\;,  $$
where $\VC\in\bbR^{n,n}$ is
$$\VC =\begin{bmatrix}
 2 & -1 &  0 & \cdots & 0 \\
-1 &  2 & -1 & \ddots & \vdots \\
 0 & \ddots & \ddots & \ddots & 0\\
\vdots & \ddots& -1 & 2 & -1\\
 0 & \cdots & 0 & -1 & 2
\end{bmatrix}\;.$$ 
In order to use standard interfaces to RK-SSM for first order ODEs, collect $\Vu$ and $\Vv$ in a $(2n)$-dimensional vector $\Vy=[\Vu;\Vv]$. Then the system reads
$$ \dot \Vy = \Vf(\Vy) := 
\begin{bmatrix} y_{n+1} \\  \vdots  \\ y_{2n}\\  \VC^{-1} \Vg(y_1,\ldots,y_l)  \end{bmatrix}\;. $$
\end{solution}
\end{subproblem}

%%%%%%%%%%%% SUBPROBLEM 2

\begin{subproblem}[3] \label{subprb:SystemODEs_1}
Apply the function \texttt{errors} constructed in \ref{prb:order-is-not-all} to the IVP obtained in the previous subproblem. Use
\[
n=5\;,\qquad u_{0,i} =  i/n\;, \qquad v_{0,i}=-1\;,\qquad T=1,
\]
and the classical RK method of order 4. Construct any sparse matrix encountered as a sparse matrix in \Eigen{}. Comment the order of convergence observed.
\begin{solution}
See file \texttt{system.cpp} for the implementation. We observe convergence of order 4.00: this is expected since the function  $\Vf$ is smooth.
\end{solution}
\end{subproblem}
\end{problem}